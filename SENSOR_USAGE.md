# 传感器数据模拟器使用说明

## 功能

`sensor_simulator.py` 是一个一键式脚本，用于生成并推送模拟的加速度传感器数据到MuMu模拟器。

## 使用场景

在完成GPS模拟跑步后，在应用中点击"结束跑步"**之前**，运行此脚本替换传感器数据。

**重要**: 应用会在跑步过程中自动生成sensor文件，本脚本会**同名替换**该文件，确保数据匹配。

## 使用步骤

### 1. 确保已完成GPS模拟

运行 `main.py` 完成跑步路径模拟。

### 2. 运行传感器模拟器

```bash
python sensor_simulator.py
```

### 3. 选择要替换的文件

脚本会列出模拟器中最近的sensor文件：
- 通常选择 **1**（最新的文件，即本次跑步生成的）
- 按 Enter 使用默认选择

### 4. 输入运动参数

脚本会询问：
- **运动时长**（秒）：输入本次跑步的总时间，例如 `1143`（约19分钟）
- **平均速度**（m/s）：输入平均速度，例如 `2.8`

提示：如果跑了3200米，用时约1143秒，平均速度约2.8 m/s

### 5. 自动完成

脚本会自动：
1. 查询模拟器中已有的sensor文件
2. 让用户选择要替换哪个文件
3. 生成符合真实运动模式的加速度数据
4. **同名替换**选定的文件
5. 显示成功消息

### 5. 结束跑步

看到 "SUCCESS! 传感器数据已就绪！" 后，即可在应用中点击"结束跑步"。

## 示例运行

```
============================================================
  传感器数据模拟器
============================================================

OK 找到 ADB: D:\software\MuMu Player 12\nx_main\adb.exe

正在查询模拟器中的sensor文件...

找到 3 个sensor文件 (按修改时间排序):

  1. a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt
     修改时间: 2024-12-15 14:30:45

  2. f9876543-21ab-cdef-0123-456789abcdef.txt
     修改时间: 2024-12-15 10:15:30

  3. 12345678-90ab-cdef-1234-567890abcdef.txt
     修改时间: 2024-12-14 16:20:10

请选择要替换的文件 (输入序号):
  提示: 通常选择 1 (最近修改的文件，即本次跑步)
选择 [1]: 1

>> 将替换文件: a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt

请输入本次跑步的持续时间(秒):
  提示: 3200米 @ 2.8m/s ~= 1143秒 ~= 19分钟
时长(秒) [1143]: 1143
平均速度(m/s) [2.8]: 2.8

开始生成传感器数据...
生成参数:
  采样数: 11430
  步频: 2.73 Hz (164 步/分钟)
  基础幅度: 15.00 m/s^2

数据统计:
  数据点数: 11430
  平均值: 15.47 m/s^2
  标准差: 10.09 m/s^2
  最小值: 0.50 m/s^2
  最大值: 48.21 m/s^2

目标文件: a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt

OK 已生成本地文件: a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt (123456 字节)

确保模拟器目录存在...
正在推送文件到模拟器...
OK 推送成功: /storage/emulated/0/sensor/a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt

============================================================
  SUCCESS! 传感器数据已替换！
============================================================

模拟器文件路径:
  /storage/emulated/0/sensor/a1b2c3d4-e5f6-7890-abcd-ef1234567890.txt

现在可以在应用中点击[结束跑步]了！

(已删除本地临时文件)
```

## 数据生成原理

脚本生成的加速度数据基于真实跑步数据的统计特征：

- **采样率**: 10 Hz (每100ms一个数据点)
- **平均值**: ~16.7 m/s² (接近真实数据)
- **标准差**: ~11-13 m/s² (与真实数据一致)
- **步频**: 150-180步/分钟 (2.5-3.0 Hz)
- **波形**: 多谐波叠加 + 随机噪声，模拟真实步态

## 技术细节

生成算法包含：
1. 基础重力分量
2. 步频周期性波动（正弦波 + 谐波）
3. 不规则性因子（模拟步态变化）
4. 高斯噪声（模拟传感器误差）

所有数据点限制在物理合理范围内 (0.5-100 m/s²)。

## 故障排除

### 问题：推送失败

检查：
- 模拟器是否正在运行
- ADB连接是否正常（运行 `main.py` 测试）
- 模拟器存储权限是否正常

### 问题：应用无法识别数据

检查：
- 文件是否成功推送到 `/storage/emulated/0/sensor/`
- 文件名格式是否正确（UUID.txt）
- 数据格式是否正确（JSON数组）

## 高级用法

### 手动指定参数（无交互）

可以修改脚本中的默认值，或通过代码直接调用生成函数：

```python
from sensor_simulator import generate_sensor_data, write_sensor_file

# 生成20分钟、速度3.0 m/s的数据
data = generate_sensor_data(1200, 3.0)
write_sensor_file(data, "custom_name.txt")
```

### 查看已推送的文件

```bash
adb shell ls -l /storage/emulated/0/sensor/
```

### 手动删除旧文件

```bash
adb shell rm /storage/emulated/0/sensor/*.txt
```
